# 팔로우 시스템 (Follow System)

## 개요

팔로우 시스템은 사용자 간의 소셜 연결을 관리하기 위한 모듈입니다. 이 시스템을 통해 사용자는 다른 사용자의 프로필을 팔로우하고, 팔로워/팔로잉 목록을 조회할 수 있습니다. 팔로우 관계가 형성되면 팔로우 대상 사용자에게 알림이 전송되어 상호작용을 촉진합니다. 이러한 소셜 연결은 사용자 경험을 향상시키고 플랫폼 내 콘텐츠 발견과 공유를 용이하게 합니다.

## 아키텍처

이 시스템은 다음과 같은 구조로 구성되어 있습니다:

```
com.fream.back.domain.user/
├── controller/
│   └── FollowController.java        # 팔로우 관리 API 엔드포인트
├── dto/
│   └── follow/
│       └── FollowDto.java           # 팔로우 정보 출력용 DTO
├── entity/
│   └── Follow.java                  # 팔로우 관계 엔티티
├── repository/
│   └── FollowRepository.java        # 팔로우 데이터 접근 계층
└── service/
    └── follow/
        ├── FollowCommandService.java  # 팔로우 생성/삭제 서비스
        └── FollowQueryService.java    # 팔로우 조회 서비스
```

## 주요 구성 요소

### 팔로우 관리

1. **FollowController**: 팔로우 생성, 삭제, 팔로워/팔로잉 목록 조회를 위한 API 컨트롤러
2. **FollowCommandService**: 팔로우 관계 생성 및 삭제 비즈니스 로직을 담당하는 서비스
3. **FollowQueryService**: 팔로워 및 팔로잉 목록 조회 비즈니스 로직을 담당하는 서비스
4. **FollowRepository**: 팔로우 데이터를 데이터베이스에서 접근하는 레포지토리

### 데이터 객체

1. **FollowDto**: 팔로우 정보를 담는 DTO (Data Transfer Object)
2. **Follow**: 팔로우 관계를 저장하는 엔티티

## 데이터 모델

### 팔로우 (Follow) 엔티티

팔로우 엔티티는 다음과 같은 필드를 포함합니다:

- **id**: 팔로우 관계 ID (PK)
- **follower**: 팔로우를 하는 프로필 (Profile 엔티티 참조)
- **following**: 팔로우를 받는 프로필 (Profile 엔티티 참조)
- **created_at**: 팔로우 관계가 생성된 시간 (BaseTimeEntity에서 상속)
- **updated_at**: 팔로우 관계가 수정된 시간 (BaseTimeEntity에서 상속)

## API 엔드포인트

### 팔로우 관리 API

```
POST /follows/{profileId}
```
지정된 프로필 ID를 팔로우합니다.

**응답 예시:**
```
팔로우가 성공적으로 추가되었습니다.
```

```
DELETE /follows/{profileId}
```
지정된 프로필 ID의 팔로우를 취소합니다.

**응답 예시:**
```
팔로우가 성공적으로 삭제되었습니다.
```

```
GET /follows/followers?page=0&size=10
```
현재 인증된 사용자의 팔로워 목록을 페이지네이션으로 조회합니다.

**응답 예시:**
```json
{
  "content": [
    {
      "profileId": 123,
      "profileName": "user_one",
      "profileImageUrl": "profile_123_abc.jpg"
    },
    {
      "profileId": 456,
      "profileName": "user_two",
      "profileImageUrl": "profile_456_def.jpg"
    }
  ],
  "pageable": {
    "sort": {
      "empty": true,
      "sorted": false,
      "unsorted": true
    },
    "offset": 0,
    "pageNumber": 0,
    "pageSize": 10,
    "paged": true,
    "unpaged": false
  },
  "totalPages": 1,
  "totalElements": 2,
  "last": true,
  "size": 10,
  "number": 0,
  "sort": {
    "empty": true,
    "sorted": false,
    "unsorted": true
  },
  "numberOfElements": 2,
  "first": true,
  "empty": false
}
```

```
GET /follows/followings?page=0&size=10
```
현재 인증된 사용자가 팔로우하고 있는 프로필 목록을 페이지네이션으로 조회합니다.

**응답 예시:**
(팔로워 목록 조회와 동일한 형식)

## 인증 및 권한

- 모든 API 요청은 사용자 인증이 필요합니다.
- 인증은 SecurityContextHolder에서 현재 인증된 사용자의 이메일을 추출하여 처리합니다.
- 각 사용자는 자신의 팔로우 관계만 관리할 수 있습니다.

## 비즈니스 로직

### 팔로우 생성

1. 인증된 사용자의 이메일로 자신의 프로필을 조회합니다.
2. 팔로우하려는 프로필 ID로 해당 프로필을 조회합니다.
3. 새로운 Follow 엔티티를 생성하여 두 프로필 간의 팔로우 관계를 설정합니다.
4. 생성된 팔로우 관계를 데이터베이스에 저장합니다.
5. 팔로우 알림을 생성하여 팔로우 대상 사용자에게 알립니다.

### 팔로우 취소

1. 인증된 사용자의 이메일로 자신의 프로필을 조회합니다.
2. 팔로우를 취소하려는 프로필 ID로 해당 프로필을 조회합니다.
3. 두 프로필 간의 팔로우 관계를 조회합니다.
    - 팔로우 관계가 없다면 예외를 발생시킵니다.
4. 팔로우 관계를 데이터베이스에서 삭제합니다.

### 팔로워 목록 조회

1. 인증된 사용자의 이메일로 자신의 프로필을 조회합니다.
2. 프로필 ID를 사용하여 해당 프로필을 팔로우하는 모든 팔로워 관계를 페이지네이션으로 조회합니다.
3. 각 팔로워 프로필의 기본 정보(ID, 이름, 이미지 URL)를 DTO로 변환하여 반환합니다.

### 팔로잉 목록 조회

1. 인증된 사용자의 이메일로 자신의 프로필을 조회합니다.
2. 프로필 ID를 사용하여 해당 프로필이 팔로우하는 모든 팔로잉 관계를 페이지네이션으로 조회합니다.
3. 각 팔로잉 프로필의 기본 정보(ID, 이름, 이미지 URL)를 DTO로 변환하여 반환합니다.

## 알림 통합

팔로우 시스템은 알림 시스템과 통합되어 있습니다:

1. 사용자가 다른 사용자를 팔로우하면, 팔로우 대상 사용자에게 알림이 전송됩니다.
2. 알림은 다음 정보를 포함합니다:
    - 수신자 ID: 팔로우 대상 사용자의 ID
    - 카테고리: STYLE
    - 타입: FOLLOW
    - 메시지: "[팔로워 이름]님이 회원님을 팔로우 했습니다."

## 구현 참고사항

### 개발자를 위한 안내

1. **팔로우 관계 중복 확인**:
    - 현재 구현에서는 팔로우 생성 시 중복 체크가 명시적으로 되어있지 않습니다.
    - 팔로우 생성 전에 이미 팔로우 관계가 있는지 확인하는 로직을 추가하는 것이 좋습니다.

2. **팔로우 상태 확인**:
    - 특정 사용자가 다른 사용자를 팔로우하고 있는지 확인하는 API를 추가할 수 있습니다.
    - 예: `GET /follows/check/{profileId}`

3. **상호 팔로우 관계 처리**:
    - 양방향 팔로우(서로 팔로우) 상태를 확인하는 기능을 추가할 수 있습니다.
    - 이는 친구 관계나 메시지 기능에 활용할 수 있습니다.

4. **팔로워/팔로잉 카운트**:
    - 프로필 정보 조회 시 팔로워/팔로잉 수를 포함하는 API를 추가할 수 있습니다.

### 보안 고려사항

1. **비공개 프로필 처리**:
    - 비공개 프로필의 경우 팔로우 요청을 별도로 처리하는 로직을 구현해야 할 수 있습니다.
    - 팔로우 요청 수락/거절 기능을 추가할 수 있습니다.

2. **차단된 사용자 처리**:
    - 차단된 사용자는 팔로우할 수 없도록 제한해야 합니다.
    - 팔로우 생성 및 조회 시 차단 목록을 확인하는 로직을 추가해야 합니다.

## 비즈니스 활용 방안

팔로우 시스템은 다음과 같은 비즈니스 기능에 활용될 수 있습니다:

1. **개인화된 피드**: 사용자가 팔로우한 계정의 콘텐츠를 기반으로 개인화된 피드를 구성할 수 있습니다.
2. **인플루언서 마케팅**: 팔로워 수가 많은 인플루언서를 식별하여 마케팅 캠페인에 활용할 수 있습니다.
3. **사용자 참여 유도**: 팔로우 추천 기능을 통해 플랫폼 내 사용자 활동과 참여를 촉진할 수 있습니다.
4. **콘텐츠 발견**: 사용자가 팔로우한 계정의 관심사를 분석하여 관련 콘텐츠를 추천할 수 있습니다.

## 문제 해결

1. **팔로우 생성 실패**:
    - 팔로우하려는 프로필이 존재하는지 확인하세요.
    - 이미 팔로우 관계가 있는지 확인하세요.

2. **팔로우 취소 실패**:
    - 취소하려는 팔로우 관계가 실제로 존재하는지 확인하세요.

3. **팔로워/팔로잉 목록 조회 실패**:
    - 페이지네이션 파라미터가 올바른지 확인하세요.
    - 사용자 프로필이 올바르게 로드되는지 확인하세요.

4. **인증 오류**:
    - 로그인 상태가 올바른지, SecurityContext에 사용자 정보가 제대로 설정되어 있는지 확인하세요.