# μ£Όμ†λ΅ μ‹μ¤ν… (Address System)

## κ°μ”

μ£Όμ†λ΅ μ‹μ¤ν…μ€ μ‚¬μ©μμ λ°°μ†΅μ§€ μ •λ³΄λ¥Ό κ΄€λ¦¬ν•κΈ° μ„ν• λ¨λ“μ…λ‹λ‹¤. μ΄ μ‹μ¤ν…μ€ μ‚¬μ©μλ³„λ΅ μ—¬λ¬ λ°°μ†΅ μ£Όμ†λ¥Ό μƒμ„±, μ΅°ν, μμ •, μ‚­μ ν•  μ μλ” κΈ°λ¥μ„ μ κ³µν•λ©°, κΈ°λ³Έ λ°°μ†΅μ§€ μ„¤μ • κΈ°λ¥λ„ μ§€μ›ν•©λ‹λ‹¤. CQRS ν¨ν„΄μ— λ”°λΌ λ…λ Ή(Command)κ³Ό μ΅°ν(Query) μ‘μ—…μ΄ λ¶„λ¦¬λμ–΄ μμ–΄ ν¨μ¨μ μΈ λ¦¬μ†μ¤ κ΄€λ¦¬κ°€ κ°€λ¥ν•©λ‹λ‹¤.

**ν•µμ‹¬ νΉμ§•:**
- **κ°μΈμ •λ³΄ λ³΄νΈ**: κ²°μ •μ  μ•”νΈν™”μ™€ μ–‘λ°©ν–¥ μ•”νΈν™”λ¥Ό μ΅°ν•©ν• μ΄μ¤‘ λ³΄μ• μ²΄κ³„
- **κ²€μƒ‰ κΈ°λ¥**: μ•”νΈν™”λ μƒνƒμ—μ„λ„ μ΄λ¦„, μ „ν™”λ²νΈ, μ£Όμ† κ²€μƒ‰ κ°€λ¥
- **CQRS ν¨ν„΄**: λ…λ Ήκ³Ό μ΅°ν μ‘μ—…μ μ™„μ „ν• λ¶„λ¦¬

## μ•„ν‚¤ν…μ²

μ΄ μ‹μ¤ν…μ€ CQRS(Command Query Responsibility Segregation) ν¨ν„΄μ„ λ”°λ¥΄λ©° λ‹¤μκ³Ό κ°™μ΄ κµ¬μ„±λμ–΄ μμµλ‹λ‹¤:

```
com.fream.back.domain.address/
β”β”€β”€ controller/
β”‚   β”β”€β”€ command/          # μ£Όμ† μƒμ„±, μμ •, μ‚­μ λ¥Ό μ„ν• μ»¨νΈλ΅¤λ¬
β”‚   β””β”€β”€ query/            # μ£Όμ† μ΅°νλ¥Ό μ„ν• μ»¨νΈλ΅¤λ¬
β”β”€β”€ dto/                  # λ°μ΄ν„° μ „μ†΅ κ°μ²΄
β”β”€β”€ entity/               # λ°μ΄ν„°λ² μ΄μ¤ μ—”ν‹°ν‹°
β”β”€β”€ exception/            # λ„λ©”μΈ κ΄€λ ¨ μμ™Έ ν΄λμ¤
β”β”€β”€ repository/           # λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµ
β””β”€β”€ service/
    β”β”€β”€ command/          # μ£Όμ† μƒμ„±, μμ •, μ‚­μ λ¥Ό μ„ν• μ„λΉ„μ¤
    β””β”€β”€ query/            # μ£Όμ† μ΅°νλ¥Ό μ„ν• μ„λΉ„μ¤
```

## λ³΄μ• λ° μ•”νΈν™” μ²΄κ³„

### μ΄μ¤‘ μ•”νΈν™” μ „λµ

κ°μΈμ •λ³΄ λ³΄νΈμ™€ κ²€μƒ‰ κΈ°λ¥μ„ λ¨λ‘ λ§μ΅±μ‹ν‚¤κΈ° μ„ν•΄ **ν•„λ“λ³„ μ°¨λ³„ μ•”νΈν™”** λ°©μ‹μ„ μ μ©ν–μµλ‹λ‹¤:

#### 1. κ²°μ •μ  μ•”νΈν™” (Deterministic Encryption)
**μ μ© ν•„λ“**: μ΄λ¦„, μ „ν™”λ²νΈ, μ£Όμ†, μ°νΈλ²νΈ
- **νΉμ§•**: λ™μΌν• μ…λ ¥κ°’μ— λ€ν•΄ ν•­μƒ λ™μΌν• μ•”νΈν™” κ²°κ³Ό μƒμ„±
- **μ¥μ **: μ•”νΈν™”λ μƒνƒμ—μ„λ„ κ²€μƒ‰ κ°€λ¥
- **μ•κ³ λ¦¬μ¦**: AES/ECB/PKCS5Padding + SHA-256 κΈ°λ° ν‚¤ μƒμ„±

```java
// κ²€μƒ‰ μμ‹
String encryptedName = encryptionUtil.encryptForSearch("ν™κΈΈλ™");
List<Address> addresses = addressRepository.findByUserAndRecipientName(user, encryptedName);
```

#### 2. μ–‘λ°©ν–¥ μ•”νΈν™” (Bidirectional Encryption)
**μ μ© ν•„λ“**: μƒμ„Έμ£Όμ†
- **νΉμ§•**: IV(Initialization Vector) μ‚¬μ©μΌλ΅ λ†’μ€ λ³΄μ•μ„±
- **μ¥μ **: λ™μΌν• μ…λ ¥κ°’λ„ λ§¤λ² λ‹¤λ¥Έ μ•”νΈν™” κ²°κ³Ό
- **μ•κ³ λ¦¬μ¦**: AES/CBC/PKCS5Padding

```java
// μƒμ„Έμ£Όμ†λ” λ³΄μ•μ„± μ°μ„ 
String encryptedDetail = encryptionUtil.encrypt("123λ™ 456νΈ");
```

### μ•”νΈν™” μ ν‹Έλ¦¬ν‹° κµ¬μ΅°

```java
@Component
public class PersonalDataEncryptionUtil {
    
    // κ²°μ •μ  μ•”νΈν™” (κ²€μƒ‰ κ°€λ¥)
    public String deterministicEncrypt(String plainText);
    public String deterministicDecrypt(String encryptedText);
    
    // μ–‘λ°©ν–¥ μ•”νΈν™” (λ³΄μ•μ„± μ°μ„ )
    public String encrypt(String plainText);
    public String decrypt(String encryptedText);
    
    // κ²€μƒ‰μ© νΈμ λ©”μ„λ“
    public String encryptForSearch(String plainText);
}
```

## μ£Όμ” κµ¬μ„± μ”μ†

### Controller

1. **AddressCommandController**: μ£Όμ† μƒμ„±, μμ •, μ‚­μ  λ“±μ λ…λ Ή μ‘μ—…μ„ μ²λ¦¬ν•©λ‹λ‹¤.
2. **AddressQueryController**: μ£Όμ† λ©λ΅ μ΅°ν, κ°λ³„ μ£Όμ† μ΅°ν, κ²€μƒ‰ λ“±μ μ΅°ν μ‘μ—…μ„ μ²λ¦¬ν•©λ‹λ‹¤.

### Service

1. **AddressCommandService**: μ£Όμ† μƒμ„±, μμ •, μ‚­μ  λ“±μ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ²λ¦¬ν•©λ‹λ‹¤.
2. **AddressQueryService**: μ£Όμ† μ΅°νμ™€ κ²€μƒ‰ κ΄€λ ¨ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ²λ¦¬ν•©λ‹λ‹¤.

### Repository

**AddressRepository**: JPAλ¥Ό μ΄μ©ν• λ°μ΄ν„°λ² μ΄μ¤ μ ‘κ·Ό μΈν„°νμ΄μ¤λ΅, μ•”νΈν™”λ λ°μ΄ν„° κ²€μƒ‰ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

#### μ£Όμ” κ²€μƒ‰ λ©”μ„λ“:
- `findByUserAndRecipientName()`: μ΄λ¦„μΌλ΅ κ²€μƒ‰
- `findByUserAndPhoneNumber()`: μ „ν™”λ²νΈλ΅ κ²€μƒ‰
- `findByUserAndAddress()`: μ£Όμ†λ΅ κ²€μƒ‰
- `findByUserAndZipCode()`: μ°νΈλ²νΈλ΅ κ²€μƒ‰
- `findByUserAndMultipleFields()`: λ³µν•© μ΅°κ±΄ κ²€μƒ‰

### Entity

**Address**: μ£Όμ† μ •λ³΄λ¥Ό μ €μ¥ν•λ” JPA μ—”ν‹°ν‹°μ…λ‹λ‹¤. `BaseTimeEntity`λ¥Ό μƒμ†λ°›μ•„ μƒμ„±/μμ • μ‹κ°„ μ •λ³΄λ¥Ό μλ™μΌλ΅ κ΄€λ¦¬ν•©λ‹λ‹¤.

### DTO

1. **AddressCreateDto**: μ£Όμ† μƒμ„± μ”μ²­μ— μ‚¬μ©λλ” DTOμ…λ‹λ‹¤.
2. **AddressUpdateDto**: μ£Όμ† μμ • μ”μ²­μ— μ‚¬μ©λλ” DTOμ…λ‹λ‹¤.
3. **AddressResponseDto**: μ£Όμ† μ •λ³΄ μ‘λ‹µμ— μ‚¬μ©λλ” DTOμ…λ‹λ‹¤.
4. **AddressListResponseDto**: μ£Όμ† λ©λ΅ μ‘λ‹µμ— μ‚¬μ©λλ” DTOμ…λ‹λ‹¤.

### Exception

1. **AddressException**: μ£Όμ† κ΄€λ ¨ λ¨λ“  μμ™Έμ κΈ°λ³Έ ν΄λμ¤μ…λ‹λ‹¤.
2. **AddressNotFoundException**: μ£Όμ†λ¥Ό μ°Ύμ„ μ μ—†μ„ λ• λ°μƒν•λ” μμ™Έμ…λ‹λ‹¤.
3. **AddressUserNotFoundException**: μ£Όμ†μ™€ κ΄€λ ¨λ μ‚¬μ©μλ¥Ό μ°Ύμ„ μ μ—†μ„ λ• λ°μƒν•λ” μμ™Έμ…λ‹λ‹¤.
4. **AddressAccessDeniedException**: μ£Όμ†μ— λ€ν• μ ‘κ·Ό κ¶ν•μ΄ μ—†μ„ λ• λ°μƒν•λ” μμ™Έμ…λ‹λ‹¤.

## μ£Όμ” κΈ°λ¥

### μ£Όμ† μƒμ„±

```
POST /addresses
```

μ‚¬μ©μλ” μλ ΉμΈ μ΄λ¦„, μ „ν™”λ²νΈ, μ°νΈλ²νΈ, μ£Όμ†, μƒμ„Έ μ£Όμ† μ •λ³΄μ™€ ν•¨κ» κΈ°λ³Έ λ°°μ†΅μ§€ μ—¬λ¶€λ¥Ό μ„¤μ •ν•  μ μμµλ‹λ‹¤. κΈ°λ³Έ λ°°μ†΅μ§€λ΅ μ„¤μ •ν•λ©΄ μ΄μ „μ— μ„¤μ •λ κΈ°λ³Έ λ°°μ†΅μ§€λ” μλ™μΌλ΅ ν•΄μ λ©λ‹λ‹¤.

**μ”μ²­ λ³Έλ¬Έ μμ‹:**
```json
{
  "recipientName": "ν™κΈΈλ™",
  "phoneNumber": "01012345678",
  "zipCode": "12345",
  "address": "μ„μΈμ‹ κ°•λ‚¨κµ¬ ν…ν—¤λ€λ΅",
  "detailedAddress": "123λ²κΈΈ 45, 6λ™ 789νΈ",
  "isDefault": true
}
```

### μ£Όμ† μμ •

```
PUT /addresses
```

μ£Όμ† IDμ™€ ν•¨κ» μμ •ν•  μ •λ³΄λ¥Ό μ „μ†΅ν•μ—¬ κΈ°μ΅΄ μ£Όμ†λ¥Ό μμ •ν•©λ‹λ‹¤. κΈ°λ³Έ λ°°μ†΅μ§€λ΅ μ„¤μ •ν•λ©΄ λ‹¤λ¥Έ λ¨λ“  μ£Όμ†μ κΈ°λ³Έ λ°°μ†΅μ§€ μ„¤μ •μ΄ ν•΄μ λ©λ‹λ‹¤.

### μ£Όμ† μ‚­μ 

```
DELETE /addresses/{addressId}
```

μ§€μ •λ IDμ μ£Όμ†λ¥Ό μ‚­μ ν•©λ‹λ‹¤.

### μ£Όμ† λ©λ΅ μ΅°ν

```
GET /addresses
```

ν„μ¬ λ΅κ·ΈμΈν• μ‚¬μ©μμ λ¨λ“  μ£Όμ† λ©λ΅μ„ μ΅°νν•©λ‹λ‹¤.

### νΉμ • μ£Όμ† μ΅°ν

```
GET /addresses/{addressId}
```

μ§€μ •λ IDμ μ£Όμ† μ •λ³΄λ¥Ό μ΅°νν•©λ‹λ‹¤.

### π†• μ£Όμ† κ²€μƒ‰ κΈ°λ¥

κ²°μ •μ  μ•”νΈν™”λ¥Ό ν™μ©ν• μƒλ΅μ΄ κ²€μƒ‰ κΈ°λ¥λ“¤:

#### μ΄λ¦„μΌλ΅ κ²€μƒ‰
```
GET /addresses/search/by-name?name=ν™κΈΈλ™
```

#### μ „ν™”λ²νΈλ΅ κ²€μƒ‰
```
GET /addresses/search/by-phone?phone=01012345678
```

#### μ£Όμ†λ΅ κ²€μƒ‰
```
GET /addresses/search/by-address?address=μ„μΈμ‹ κ°•λ‚¨κµ¬
```

**κ²€μƒ‰ μ‘λ™ μ›λ¦¬:**
1. κ²€μƒ‰μ–΄λ¥Ό κ²°μ •μ  μ•”νΈν™”λ΅ λ³€ν™
2. μ•”νΈν™”λ κ²€μƒ‰μ–΄μ™€ DBμ μ•”νΈν™”λ κ°’ λΉ„κµ
3. μΌμΉν•λ” λ μ½”λ“μ μ•”νΈν™”λ κ°’λ“¤μ„ λ³µνΈν™”ν•μ—¬ μ‘λ‹µ

## λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§

`address` ν…μ΄λΈ”μ—λ” λ‹¤μ ν•„λ“κ°€ ν¬ν•¨λ©λ‹λ‹¤:

| ν•„λ“             | νƒ€μ…         | μ μ•½μ΅°κ±΄                      | μ•”νΈν™” λ°©μ‹      | μ„¤λ…                           |
|-----------------|--------------|------------------------------|----------------|-------------------------------|
| id              | BIGINT       | PK, AUTO_INCREMENT           | -              | κΈ°λ³Έ ν‚¤                        |
| user_id         | BIGINT       | FK, NOT NULL                 | -              | μ‚¬μ©μ μ™Έλ ν‚¤ (λ‹¤λ€μΌ κ΄€κ³„)     |
| recipient_name  | VARCHAR      | NOT NULL                     | **κ²°μ •μ **      | μλ ΉμΈ μ΄λ¦„ (κ²€μƒ‰ κ°€λ¥)         |
| phone_number    | VARCHAR      | NOT NULL                     | **κ²°μ •μ **      | μ—°λ½μ² (κ²€μƒ‰ κ°€λ¥)             |
| zip_code        | VARCHAR(5)   | NOT NULL                     | **κ²°μ •μ **      | μ°νΈλ²νΈ (κ²€μƒ‰ κ°€λ¥)           |
| address         | VARCHAR      | NOT NULL                     | **κ²°μ •μ **      | μ£Όμ† (κ²€μƒ‰ κ°€λ¥)              |
| detailed_address| VARCHAR      |                              | **μ–‘λ°©ν–¥**      | μƒμ„Έ μ£Όμ† (λ³΄μ•μ„± μ°μ„ )        |
| is_default      | BOOLEAN      | DEFAULT FALSE                | -              | κΈ°λ³Έ λ°°μ†΅μ§€ μ—¬λ¶€               |
| created_at      | TIMESTAMP    | NOT NULL                     | -              | μƒμ„± μ‹κ°„                     |
| updated_at      | TIMESTAMP    | NOT NULL                     | -              | μμ • μ‹κ°„                     |

## μΈλ±μ¤ μ •λ³΄

μ„±λ¥ μµμ ν™”λ¥Ό μ„ν•΄ λ‹¤μ μΈλ±μ¤κ°€ μ μ©λμ–΄ μμµλ‹λ‹¤:

| μΈλ±μ¤ μ΄λ¦„          | λ€μƒ μ»¬λΌ         | λ©μ                             |
|--------------------|------------------|--------------------------------|
| idx_user_id        | user_id          | μ‚¬μ©μλ³„ μ£Όμ† λ©λ΅ μ΅°ν μµμ ν™”     |
| idx_is_default     | is_default       | κΈ°λ³Έ μ£Όμ† κ²€μƒ‰ μµμ ν™”             |
| idx_recipient_name | recipient_name   | μ΄λ¦„ κ²€μƒ‰ μµμ ν™”                 |
| idx_phone_number   | phone_number     | μ „ν™”λ²νΈ κ²€μƒ‰ μµμ ν™”             |
| idx_address        | address          | μ£Όμ† κ²€μƒ‰ μµμ ν™”                 |

## μ ν¨μ„± κ²€μ¦

μ£Όμ† μƒμ„± λ° μμ • μ‹ λ‹¤μκ³Ό κ°™μ€ μ ν¨μ„± κ²€μ¦μ΄ μ μ©λ©λ‹λ‹¤:

### AddressCreateDto

| ν•„λ“            | κ²€μ¦ μ–΄λ…Έν…μ΄μ…                           | μ¤λ¥ λ©”μ‹μ§€                                               |
|----------------|-----------------------------------------|----------------------------------------------------------|
| recipientName  | @NotBlank                               | "μλ ΉμΈ μ΄λ¦„μ€ ν•„μ μ…λ ¥μ‚¬ν•­μ…λ‹λ‹¤."                         |
| phoneNumber    | @NotBlank, @Pattern(regexp="\\d{10,11}") | "μ „ν™”λ²νΈ ν•μ‹μ΄ μ¬λ°”λ¥΄μ§€ μ•μµλ‹λ‹¤. μ«μ 10-11μλ¦¬λ΅ μ…λ ¥ν•΄μ£Όμ„Έμ”." |
| zipCode        | @NotBlank, @Pattern(regexp="\\d{5}")     | "μ°νΈλ²νΈ ν•μ‹μ΄ μ¬λ°”λ¥΄μ§€ μ•μµλ‹λ‹¤. 5μλ¦¬ μ«μλ΅ μ…λ ¥ν•΄μ£Όμ„Έμ”."   |
| address        | @NotBlank                               | "μ£Όμ†λ” ν•„μ μ…λ ¥μ‚¬ν•­μ…λ‹λ‹¤."                                |

### AddressUpdateDto

| ν•„λ“            | κ²€μ¦ μ–΄λ…Έν…μ΄μ…                           | μ¤λ¥ λ©”μ‹μ§€                                               |
|----------------|-----------------------------------------|----------------------------------------------------------|
| addressId      | @NotNull                                | "μ£Όμ† IDλ” ν•„μ μ…λ ¥μ‚¬ν•­μ…λ‹λ‹¤."                             |
| phoneNumber    | @Pattern(regexp="^$\|\\d{10,11}")        | "μ „ν™”λ²νΈ ν•μ‹μ΄ μ¬λ°”λ¥΄μ§€ μ•μµλ‹λ‹¤. μ«μ 10-11μλ¦¬λ΅ μ…λ ¥ν•΄μ£Όμ„Έμ”." |
| zipCode        | @Pattern(regexp="^$\|\\d{5}")            | "μ°νΈλ²νΈ ν•μ‹μ΄ μ¬λ°”λ¥΄μ§€ μ•μµλ‹λ‹¤. 5μλ¦¬ μ«μλ΅ μ…λ ¥ν•΄μ£Όμ„Έμ”."   |

## λ³΄μ•

### μ ‘κ·Ό μ μ–΄
λ¨λ“  μ£Όμ† κ΄€λ ¨ μ‘μ—…μ€ μΈμ¦λ μ‚¬μ©μλ§ μν–‰ν•  μ μμΌλ©°, `SecurityUtils.extractEmailFromSecurityContext()`λ¥Ό ν†µν•΄ ν„μ¬ λ΅κ·ΈμΈν• μ‚¬μ©μμ μ΄λ©”μΌμ„ μ¶”μ¶ν•©λ‹λ‹¤. λν•, κ° μ‚¬μ©μλ” μμ‹ μ μ£Όμ†λ§ μ΅°ν, μμ •, μ‚­μ ν•  μ μμµλ‹λ‹¤.

### μ•”νΈν™” ν‚¤ κ΄€λ¦¬
```yaml
# application.yml
personal-data:
  encryption:
    secret-key: ${ENCRYPTION_SECRET_KEY:your-32-char-secret-key}
    iv: ${ENCRYPTION_IV:your-16-char-iv}
```

**μ£Όμμ‚¬ν•­:**
- ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” λ°λ“μ‹ ν™κ²½λ³€μλ΅ ν‚¤ κ΄€λ¦¬
- ν‚¤ λ³€κ²½ μ‹ κΈ°μ΅΄ λ°μ΄ν„° λ§μ΄κ·Έλ μ΄μ… ν•„μ”
- μ •κΈ°μ μΈ ν‚¤ λ΅ν…μ΄μ… μ •μ±… μλ¦½ κ¶μ¥

## κµ¬ν„ μ°Έκ³ μ‚¬ν•­

### κΈ°λ³Έ λ°°μ†΅μ§€ κ΄€λ¦¬

νΉμ • μ£Όμ†λ¥Ό κΈ°λ³Έ λ°°μ†΅μ§€λ΅ μ„¤μ •ν•λ©΄ ν•΄λ‹Ή μ‚¬μ©μμ λ‹¤λ¥Έ λ¨λ“  μ£Όμ†λ” κΈ°λ³Έ λ°°μ†΅μ§€ μ„¤μ •μ΄ ν•΄μ λ©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ ν• λ²μ— ν•λ‚μ κΈ°λ³Έ λ°°μ†΅μ§€λ§ μ΅΄μ¬ν•λ„λ΅ λ³΄μ¥ν•©λ‹λ‹¤.

### νΈμ λ©”μ„λ“

`Address` μ—”ν‹°ν‹°μ—λ” λ‹¤μκ³Ό κ°™μ€ νΈμ λ©”μ„λ“κ°€ κµ¬ν„λμ–΄ μμµλ‹λ‹¤:

1. **updateAddress**: μ£Όμ† μ •λ³΄λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤. nullμ΄ μ•„λ‹ ν•„λ“λ§ μ—…λ°μ΄νΈλ©λ‹λ‹¤.
   ```java
   public void updateAddress(String recipientName, String phoneNumber, String zipCode,
                          String address, String detailedAddress, Boolean isDefault)
   ```

2. **assignUser**: μ£Όμ†μ— μ‚¬μ©μλ¥Ό ν• λ‹Ήν•©λ‹λ‹¤.
   ```java
   public void assignUser(User user)
   ```

3. **unassignUser**: μ£Όμ†μ—μ„ μ‚¬μ©μ ν• λ‹Ήμ„ ν•΄μ ν•©λ‹λ‹¤.
   ```java
   public void unassignUser()
   ```

### μμ™Έ μ²λ¦¬

μ„λΉ„μ¤μ—μ„λ” λ‹¤μκ³Ό κ°™μ€ μμ™Έ μƒν™©μ„ μ²λ¦¬ν•©λ‹λ‹¤:

| μμ™Έ ν΄λμ¤                  | μƒν™©                                | μ¤λ¥ μ½”λ“                   | HTTP μƒνƒ |
|-----------------------------|------------------------------------|-----------------------------|-----------|
| AddressUserNotFoundException | μ΅΄μ¬ν•μ§€ μ•λ” μ‚¬μ©μμ— λ€ν• μ”μ²­      | ADDRESS_USER_NOT_FOUND     | 404       |
| AddressNotFoundException    | μ΅΄μ¬ν•μ§€ μ•λ” μ£Όμ† ID μ”μ²­           | ADDRESS_NOT_FOUND          | 404       |
| AddressAccessDeniedException | λ‹¤λ¥Έ μ‚¬μ©μμ μ£Όμ†μ— μ ‘κ·Ό μ‹λ„        | ADDRESS_ACCESS_DENIED      | 403       |
| AddressInvalidDataException | μ ν¨ν•μ§€ μ•μ€ μ£Όμ† λ°μ΄ν„° μ…λ ¥        | ADDRESS_INVALID_DATA       | 400       |

## μµκ·Ό κ°μ„  μ‚¬ν•­

### π†• 2025/06/02 - κ²°μ •μ  μ•”νΈν™” λ„μ…

#### 1. μ΄μ¤‘ μ•”νΈν™” μ²΄κ³„ κµ¬ν„
- **κ²°μ •μ  μ•”νΈν™”**: μ΄λ¦„, μ „ν™”λ²νΈ, μ£Όμ†, μ°νΈλ²νΈ (κ²€μƒ‰ κ°€λ¥)
- **μ–‘λ°©ν–¥ μ•”νΈν™”**: μƒμ„Έμ£Όμ† (λ³΄μ•μ„± μ°μ„ )
- **PersonalDataEncryptionUtil** ν™•μ¥μΌλ΅ λ‘ λ°©μ‹ λ¨λ‘ μ§€μ›

#### 2. κ²€μƒ‰ κΈ°λ¥ λ€ν­ κ°•ν™”
- μ•”νΈν™”λ μƒνƒμ—μ„λ„ μ •ν™•ν• κ²€μƒ‰ κ°€λ¥
- μ΄λ¦„, μ „ν™”λ²νΈ, μ£Όμ†λ³„ κ°λ³„ κ²€μƒ‰ API μ¶”κ°€
- λ³µν•© μ΅°κ±΄ κ²€μƒ‰ μ§€μ›

#### 3. Repository κ²€μƒ‰ λ©”μ„λ“ μ¶”κ°€
```java
// μƒλ΅ μ¶”κ°€λ κ²€μƒ‰ λ©”μ„λ“λ“¤
List<Address> findByUserAndRecipientName(User user, String encryptedName);
List<Address> findByUserAndPhoneNumber(User user, String encryptedPhone);
List<Address> findByUserAndAddress(User user, String encryptedAddress);
List<Address> findByUserAndMultipleFields(...); // λ³µν•© κ²€μƒ‰
```

#### 4. μ„±λ¥ μµμ ν™”
- κ²€μƒ‰ ν•„λ“λ³„ μΈλ±μ¤ μ¶”κ°€
- κ²°μ •μ  μ•”νΈν™”λ΅ μΈν• κ²€μƒ‰ μ„±λ¥ ν–¥μƒ
- λ¶ν•„μ”ν• λ³µνΈν™” μ‘μ—… μµμ†ν™”

### 2025/04/25 - μ ν¨μ„± κ²€μ¦ κ°•ν™”
- Jakarta Bean Validation μ¶”κ°€
- μ „ν™”λ²νΈ, μ°νΈλ²νΈ μ •κ·μ‹ κ²€μ¦
- μ‚¬μ©μ μΉν™”μ  μ¤λ¥ λ©”μ‹μ§€ μ κ³µ

## μμ΅΄μ„± μ¶”κ°€ μ‚¬ν•­

Jakarta Bean Validationμ„ μ‚¬μ©ν•κΈ° μ„ν•΄ λ‹¤μ μμ΅΄μ„±μ΄ μ¶”κ°€λμ—μµλ‹λ‹¤:

**Maven:**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```

**Gradle:**
```gradle
implementation 'org.springframework.boot:spring-boot-starter-validation'
```

## ν™•μ¥ κ°€λ¥μ„±

ν–¥ν›„ λ‹¤μκ³Ό κ°™μ€ κΈ°λ¥μ„ μ¶”κ°€ν•  μ μμµλ‹λ‹¤:

1. **μ£Όμ† μ¦κ²¨μ°ΎκΈ°**: μμ£Ό μ‚¬μ©ν•λ” μ£Όμ†λ¥Ό μ¦κ²¨μ°ΎκΈ°λ΅ λ“±λ΅ν•λ” κΈ°λ¥
2. **λ°°μ†΅μ§€ λ³„λ… μ¶”κ°€**: μ‚¬μ©μκ°€ λ°°μ†΅μ§€μ— λ³„λ…μ„ μ§€μ •ν•  μ μλ” κΈ°λ¥
3. **μµκ·Ό μ‚¬μ© μμ„ κ΄€λ¦¬**: μµκ·Όμ— μ‚¬μ©ν• λ°°μ†΅μ§€λ¥Ό μ°μ„ μ μΌλ΅ ν‘μ‹
4. **λ°°μ†΅λΉ„ κ³„μ‚° μ—°λ™**: μ§€μ—­λ³„ λ°°μ†΅λΉ„ κ³„μ‚°μ„ μ„ν• κΈ°λ¥ μ—°λ™
5. **κµ­μ  μ£Όμ† μ§€μ›**: ν•΄μ™Έ λ°°μ†΅μ„ μ„ν• κµ­μ  μ£Όμ† ν•μ‹ μ§€μ›
6. **π†• λ¨μμμ λ¶„λ¦¬ κ²€μƒ‰**: ν•κΈ€ μμ/λ¨μ λ¶„λ¦¬λ¥Ό ν†µν• νΌμ§€ κ²€μƒ‰
7. **π†• μ£Όμ† μλ™μ™„μ„±**: λ„λ΅λ…μ£Όμ† API μ—°λ™μ„ ν†µν• μ‹¤μ‹κ°„ μ£Όμ† μλ™μ™„μ„±
8. **π†• κ²€μƒ‰ λ΅κ·Έ λ¶„μ„**: μ‚¬μ©μ κ²€μƒ‰ ν¨ν„΄ λ¶„μ„μ„ ν†µν• UX κ°μ„ 

## νΈλ¬λΈ”μν…

### μ•”νΈν™” κ΄€λ ¨ μ΄μ

1. **κΈ°μ΅΄ λ°μ΄ν„° λ§μ΄κ·Έλ μ΄μ…**
   ```sql
   -- κΈ°μ΅΄ ν‰λ¬Έ λ°μ΄ν„°λ¥Ό μ•”νΈν™”λ λ°μ΄ν„°λ΅ λ³€ν™ν•λ” λ§μ΄κ·Έλ μ΄μ… μ¤ν¬λ¦½νΈ ν•„μ”
   -- μ£Όμ: κ²°μ •μ  μ•”νΈν™” μ μ© ν›„ κΈ°μ΅΄ κ²€μƒ‰ μΏΌλ¦¬ μμ • ν•„μ”
   ```

2. **μ„±λ¥ μ΄μ**
   ```java
   // λ€λ‰ κ²€μƒ‰ μ‹ μΈλ±μ¤ ν™μ©μ„ μ„ν• μΏΌλ¦¬ μµμ ν™”
   @Query("SELECT a FROM Address a WHERE a.user = :user AND a.recipientName = :name")
   ```

3. **ν‚¤ κ΄€λ¦¬**
   ```yaml
   # ν™κ²½λ³„ ν‚¤ λ¶„λ¦¬ κ΄€λ¦¬ κ¶μ¥
   spring:
     profiles:
       active: prod
   ---
   spring:
     profiles: prod
   personal-data:
     encryption:
       secret-key: ${PROD_ENCRYPTION_KEY}
   ```